// Generated by CoffeeScript 1.6.2
$(function() {
  return window.checkboxlistcontroller = new CheckboxListController();
});

window.CheckboxListController = (function() {
  function CheckboxListController() {
    var element_ids, id, t, _i, _len;

    this.dom_element = $('.checkbox-list');
    this.tasks = [];
    element_ids = JSON.parse(this.dom_element.attr('data-task-ids'));
    assert(element_ids instanceof Array, "Invaild data loaded");
    for (_i = 0, _len = element_ids.length; _i < _len; _i++) {
      id = element_ids[_i];
      t = new Task(id);
      t.parent = this;
      this.tasks.push(t);
    }
  }

  CheckboxListController.prototype.onUpdate = function() {
    var html, t, _i, _len, _ref;

    html = "";
    _ref = this.tasks;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      t = _ref[_i];
      html += t.render();
    }
    return this.dom_element.html(html);
  };

  return CheckboxListController;

})();

window.Task = (function() {
  function Task(id) {
    if (id != null) {
      this.load(id);
    } else {
      this["new"]();
    }
  }

  Task.prototype.render = function() {
    return "<label><input type='checkbox'>" + this.text + "</label>";
  };

  Task.prototype.load = function(id) {
    var me;

    me = this;
    return $.get('/api/get_task', {
      id: id
    }, function(r) {
      var k, _i, _len, _ref;

      assert(r.id != null, 'Illegal or invalid Task loaded');
      _ref = ['id', 'text'];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        k = _ref[_i];
        if (r[k] != null) {
          me[k] = r[k];
        }
      }
      return me.onUpdate.call(me);
    });
  };

  Task.prototype["new"] = function() {
    return this.text = "New task";
  };

  Task.prototype.save = function() {
    var data, k, me, _i, _len, _ref;

    me = this;
    data = {};
    _ref = ['id', 'text'];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      k = _ref[_i];
      if (this[k] != null) {
        data[k] = me[k];
      }
    }
    $.get('/api/save_task', data);
    return me;
  };

  Task.prototype.onUpdate = function() {
    this.parent.onUpdate.call(this.parent);
    return this.needsUpdate = true;
  };

  return Task;

})();
